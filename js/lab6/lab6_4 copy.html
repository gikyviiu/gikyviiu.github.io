<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Редактируемая таблица</title>

</head>
<body>
    <table>
        <thead>
          <tr>
            <th>Столбец 1</th>
            <th>Столбец 2</th>
            <th>Столбец 3</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td data-content="Ячейка 1">Ячейка 1</td>
            <td data-content="Ячейка 2">Ячейка 2</td>
            <td data-content="Ячейка 3">Ячейка 3</td>
          </tr>
          <tr>
            <td data-content="Ячейка 4">Ячейка 4</td>
            <td data-content="Ячейка 5">Ячейка 5</td>
            <td data-content="Ячейка 6">Ячейка 6</td>
          </tr>
        </tbody>
      </table>
      <div class="edit-controls">
        <button class="edit-ok-button">OK</button>
        <button class="edit-cancel-button">Отмена</button>
      </div>
      

<script>
(function () {
  const table = document.querySelector('table');
  const editControls = document.querySelector('.edit-controls');
  const okButton = editControls.querySelector('.edit-ok-button');
  const cancelButton = editControls.querySelector('.edit-cancel-button');

  // Флаг, указывающий редактируется ли ячейка
  let isEditing = false;

  // Текущая редактируемая ячейка
  let currentEditedCell;

  // Создаем элемент textarea для редактирования
  const createTextarea = (cellData) => {
    const textarea = document.createElement('textarea');
    textarea.classList.add('edit-textarea');
    textarea.value = cellData;
    return textarea;
  };

  // Делегирование событий для ячеек таблицы
  table.addEventListener('click', (event) => {
    // Если клик по ячейке
    if (event.target.tagName === 'TD') {
      // Если ячейка уже редактируется, игнорируем клик
      if (isEditing) {
        return;
      }

      const cell = event.target;
      const cellData = cell.getAttribute('data-content');

      isEditing = true;
      currentEditedCell = cell;

      // Удаляем исходный контент из ячейки
      cell.textContent = '';

      // Создаем textarea для редактирования и добавляем его в ячейку
      const textarea = createTextarea(cellData);
      cell.appendChild(textarea);
      textarea.focus();

      // Отображаем элементы управления редактированием
      editControls.style.display = 'block';

      // Позиционируем элементы управления редактированием под ячейкой
      const cellRect = cell.getBoundingClientRect();
      editControls.style.top = ${cellRect.bottom}px;
      editControls.style.left = ${cellRect.left}px;

      // Устанавливаем обработчики событий на элементы управления редактированием
      okButton.addEventListener('click', () => {
        const updatedCellData = textarea.value;
        cell.setAttribute('data-content', updatedCellData);
        cell.textContent = updatedCellData;
        isEditing = false;
        editControls.style.display = 'none';
      });

      cancelButton.addEventListener('click', () => {
        cell.textContent = cellData;
        isEditing = false;
        editControls.style.display = 'none';
      });
    }
  });
})();

</script>
</body>
</html>
